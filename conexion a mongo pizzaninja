from pymysql.cursors import DictCursor

mysql_conn = pymysql.connect(
    host='localhost',
    user='root',
    password='12345678',
    database='pizza_ninja',
    port=3306,
    cursorclass=DictCursor
)

mongo_client = MongoClient('mongodb://localhost:27017/')
mongo_db = mongo_client['pizza_ninja']

tables = [
    'Customers', 'Employees', 'Pizzas', 'Ingredients', 'Orders',
    'Order_Details', 'Pizza_Ingredients', 'Payments',
    'Delivery_Status', 'Promotions'
]

try:
    with mysql_conn.cursor() as cursor:
        for table in tables:
            print(f'Migrando tabla: {table}...')

            cursor.execute(f"SELECT * FROM {table}")
            rows = cursor.fetchall()

            if rows:
                mongo_collection = mongo_db[table]
                mongo_collection.delete_many({})  # Limpiar colección antes de insertar
                mongo_collection.insert_many(rows)
                print(f'Insertados {len(rows)} documentos en {table}')
            else:
                print(f'Tabla {table} sin datos.')
finally:
    mysql_conn.close()
    print("Migración completada.")
